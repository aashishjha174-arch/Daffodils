<!doctype html>
<html lang="en">
<head>
  <title>Daffodils Public School | Sign Up</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <!-- Favicon -->
  <link rel="icon" href="images/logo.webp">
  <link rel="apple-touch-icon" href="images/logo.webp">

  <!-- Fonts & icons -->
  <link href="https://fonts.googleapis.com/css?family=Lato:300,400,700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">

  <!-- Your CSS -->
  <link rel="stylesheet" href="css/style.css">

  <!-- Background and overlay -->
  <style>
    body {
      min-height: 100vh;
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      transition: background-image 1.5s ease-in-out;
      position: relative;
    }
    body::before {
      content: "";
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.45);
      z-index: -1;
    }
    #particles-js {
      position: fixed;
      width: 100%;
      height: 100%;
      z-index: -2;
      top: 0;
      left: 0;
    }
  </style>
</head>
<body class="img js-fullheight">

<div id="particles-js"></div>

<section class="ftco-section">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-md-6 text-center mb-5">
        <h2 class="heading-section text-white">DAFFODILS PUBLIC SCHOOL</h2>
      </div>
    </div>

    <div class="row justify-content-center">
      <div class="col-md-6 col-lg-4">
        <div class="login-wrap p-4">
          <h3 class="mb-4 text-center text-white">Create an account</h3>

          <form id="signupForm" class="signin-form">
            <div class="form-group">
              <input type="text" id="username" class="form-control" placeholder="Username" required>
            </div>

            <div class="form-group">
              <label class="checkbox-wrap text-white">
                I agree to the <a href="terms.html" target="_blank" class="text-white font-weight-bold" style="text-decoration: underline;">Terms & Conditions</a>
                <input type="checkbox" id="terms" required>
                <span class="checkmark"></span>
              </label>
            </div>

            <div class="form-group">
              <button type="submit" class="form-control btn btn-primary submit px-3">
                Sign Up
              </button>
            </div>
          </form>

          <p class="w-100 text-center text-white mt-3">
            Already have an account? <a href="login.html" class="text-white font-weight-bold">Log In</a>
          </p>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Background Slideshow -->
<script>
  const images = ["images/bg.webp", "images/bg2.webp", "images/bg3.webp", "images/sample2.webp"];
  let index = 0;
  function changeBackground() {
    document.body.style.backgroundImage = `url('${images[index]}')`;
    index = (index + 1) % images.length;
  }
  changeBackground();
  setInterval(changeBackground, 5000);
</script>

<!-- Signup Functionality (password removed) -->
<script>
document.getElementById('signupForm').addEventListener('submit', async function(e) {
  e.preventDefault();
  
  const username = document.getElementById('username').value.trim();
  const terms = document.getElementById('terms').checked;

  if (!terms) {
    alert('Please agree to the Terms & Conditions');
    return;
  }

  if (!username) {
    alert('Username is required');
    return;
  }

  try {
    const res = await fetch("https://daffodils-1.onrender.com/signup", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ username })   // ‚Üê only username sent
    });

    const data = await res.json();

    if (!data.success) {
      alert(data.message);
      return;
    }

    // AUTO LOGIN (assuming backend returns token even without password)
    localStorage.setItem("token", data.token);
    localStorage.setItem("username", data.username);

    window.location.href = "load.html";

  } catch (err) {
    alert("Server error. Try again later.");
    console.error(err);
  }
});
</script>

<!-- Scripts -->
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<!-- Particles.js -->
<script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
<script>
  particlesJS("particles-js", {
    "particles": {
      "number": { "value": 60 },
      "color": { "value": "#ffffff" },
      "shape": { "type": "circle" },
      "opacity": { "value": 0.5 },
      "size": { "value": 3 },
      "line_linked": { "enable": true, "distance": 150, "color": "#ffffff", "opacity": 0.4, "width": 1 },
      "move": { "enable": true, "speed": 2 }
    },
    "interactivity": {
      "detect_on": "canvas",
      "events": { "onhover": { "enable": true, "mode": "repulse" } }
    },
    "retina_detect": true
  });
</script>

</body>
</html>
